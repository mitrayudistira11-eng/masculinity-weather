<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Weather GPS Auto</title>

<style>
/* ================= BODY ================= */

body{
margin:0;
font-family:sans-serif;
min-height:100vh;

display:flex;
justify-content:center;
align-items:flex-start;

padding:40px 0;

color:white;
overflow-y:auto;

/* üî• FIX: jangan none */
background:#050b18;

background-size:400% 400%;
animation:bgMove 20s ease infinite;
}

/* gradient move */
@keyframes bgMove{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

/* ================= TIME BACKGROUND ================= */

body.morning{
background:linear-gradient(-45deg,#FFB75E,#ED8F03,#FFD194,#FF9966);
}
body.day{
background:linear-gradient(-45deg,#56CCF2,#2F80ED,#4facfe,#00c6ff);
}
body.evening{
background:linear-gradient(-45deg,#ff9966,#ff5e62,#f7971e,#ffd200);
}
body.night{
background:linear-gradient(-45deg,#020617,#050b18,#070f1f,#000000);
}

/* ================= SKY ================= */

#sky{
position:fixed;
inset:0;
z-index:0;
pointer-events:none;
overflow:hidden;
}

/* SUN / MOON */

.sunMoon{
position:absolute;
width:120px;
height:120px;
border-radius:50%;
top:15%;
left:50%;
transform:translateX(-50%);
transition:1s;
}

.sun{
background:radial-gradient(circle,#fff799,#ffb347,#ff8800);
box-shadow:0 0 80px rgba(255,180,0,.9);
}

.moon{
background:radial-gradient(circle,#fff,#ccc,#999);
box-shadow:0 0 30px rgba(255,255,255,.6);
}

/* CLOUDS */

.clouds{
position:absolute;
inset:0;
background:
radial-gradient(circle at 20% 40%,rgba(255,255,255,.6) 60px,transparent 70px),
radial-gradient(circle at 60% 30%,rgba(255,255,255,.6) 70px,transparent 80px);
animation:cloudMove 80 ease-in-out infinite;
opacity:.3;
filter:blur(8px);
}

.cloud{
position:absolute;
background:
radial-gradient(circle at 30% 50%, rgba(255,255,255,.95) 60%, transparent 70%),
radial-gradient(circle at 60% 40%, rgba(255,255,255,.9) 70%, transparent 80%),
radial-gradient(circle at 50% 70%, rgba(255,255,255,.9) 65%, transparent 75%);
border-radius:50%;
filter:blur(2px);
pointer-events:none;
}

@keyframes cloudMove{
from{ transform:translateX(-20vw); }
to{ transform:translateX(120vw); }
}

/* STARS */

.stars{
position:absolute;
inset:0;
background-image:
radial-gradient(2px 2px at 20% 30%, white 60%, transparent),
radial-gradient(2px 2px at 70% 60%, white 60%, transparent),
radial-gradient(1px 1px at 40% 80%, white 60%, transparent);
opacity:0;
animation:twinkle 2s infinite alternate ease-in-out;
}

@keyframes twinkle{
from{opacity:.3}
to{opacity:1}
}
/* ===== RAIN PARTICLE ===== */
.rain{
position:absolute;
inset:0;
overflow:hidden;
opacity:0;
}

.drop{
position:absolute;
width:2px;
height:18px;
background:rgba(255,255,255,.9);
border-radius:2px;
transform:rotate(20deg);
animation:rainFall linear infinite;
}

@keyframes rainFall{
from{transform:translate(-40px,-20px) rotate(20deg)}
to{transform:translate(140px,110vh) rotate(20deg)}
}


/* ===== FOG SMOOTH ===== */
.fog{
position:absolute;
inset:0;
opacity:0;
filter:blur(45px);
background:
radial-gradient(circle at 30% 40%,rgba(255,255,255,.25),transparent 60%),
radial-gradient(circle at 70% 60%,rgba(255,255,255,.2),transparent 60%);
}


/* ===== LIGHTNING FLASH ===== */
.flash{
position:absolute;
inset:0;
background:white;
opacity:0;
pointer-events:none;
}/* ================= CARD ================= */

.card{
position:relative;
z-index:10;

width:420px;
max-width:90%;

padding:28px;
border-radius:22px;

background:rgba(8,15,30,0.75);
backdrop-filter:blur(14px);

border:1px solid rgba(255,255,255,0.15);
box-shadow:0 20px 60px rgba(0,0,0,0.45);
}

.big{font-size:48px;font-weight:700}
.section{margin-top:14px;font-size:13px}

.scoreBar{
height:10px;
border-radius:8px;
background:rgba(255,255,255,.15);
overflow:hidden;
margin-top:6px;
}

.scoreFill{
height:100%;
transition:.4s;
}

.data-row {
  display:flex;
  justify-content:space-between;
  padding:6px 0;
  font-size:14px;
}

#cloudType {
  font-weight:600;
}

</style>
</head>

<body>

<div id="sky">
  <div class="sunMoon" id="sunMoon"></div>
  <div class="stars" id="stars"></div>
  <div class="clouds" id="clouds"></div>
  <div class="fog" id="fog"></div>
<div class="rain" id="rain"></div>
<div class="flash" id="flash"></div>
</div>

<div class="card">
<div id="clock"></div>
<h2 id="city">Mendeteksi lokasi...</h2>
<div class="big" id="temp">--¬∞C</div>
<div id="desc"></div>
<div class="section" id="outdoorScore"></div>
<div class="data-row">
  <span>Cloud Type:</span>
  <span id="cloudType">-</span>
</div>
<div class="section" id="extra"></div>
<div class="section" id="recommendation"></div>
<div class="section" id="warning"></div>
</div>

<script>

const apiKey="b313e26bc324fe7d98b9611f6767b770";

/* ================= CLOCK ================= */
const clockEl=document.getElementById("clock");
setInterval(()=>{
clockEl.innerText=new Date().toLocaleTimeString();
},1000);

/* ================= GPS ================= */
navigator.geolocation.getCurrentPosition(pos=>{
getWeather(pos.coords.latitude,pos.coords.longitude);
});

/* ================= BACKGROUND ENGINE (FIXED) ================= */
function setDynamicBackground(weatherMain, sunrise, sunset, cloudPercent){

const body=document.body;
const sunMoon=document.getElementById("sunMoon");
const stars=document.getElementById("stars");
const clouds=document.getElementById("clouds");
const fog=document.getElementById("fog");
const rain=document.getElementById("rain");
const flash = document.getElementById("flash");
let lightningInterval=null;

body.className="";

const now=Date.now()/1000;

/* time mode */
let mode="night";

if(now < sunrise){
  mode="night";
}
else if(now < sunrise + 3600){
  mode="morning";
}
else if(now < sunset - 3600){
  mode="day";
}
else if(now < sunset){
  mode="evening";
}
else{
  mode="night";
}

body.classList.add(mode);

/* sun moon */
sunMoon.className="sunMoon "+(mode==="night"?"moon":"sun");
stars.style.opacity=(mode==="night")?1:0;

/* weather effects */
/* reset */
clouds.style.opacity=.2;
fog.style.opacity=0;
rain.style.opacity=0;
sunMoon.style.display="block";
stopLightning();
rain.innerHTML="";

/* cloudy */
setCloudIntensity(cloudPercent);

/* rain */
if(weatherMain.includes("rain") || weatherMain.includes("drizzle")){
  sunMoon.style.display="none";
  clouds.style.opacity=.8;
  fog.style.opacity=.25;
  rain.style.opacity=1;
  createRain(120);
}

/* storm */
if(weatherMain.includes("thunderstorm")){
  sunMoon.style.display="none";
  clouds.style.opacity=.9;
  fog.style.opacity=.35;
  rain.style.opacity=1;
  createRain(220);
  startLightning();
}

/* mist/fog */
if(weatherMain.includes("mist") || weatherMain.includes("fog")){
  fog.style.opacity=.45;
}
}

const flash = document.getElementById("flash");
let lightningInterval=null;

/* HUJAN PARTICLE */
function createRain(n){
  rain.innerHTML="";
  for(let i=0;i<n;i++){
    const d=document.createElement("div");
    d.className="drop";
    d.style.left=Math.random()*100+"%";
    d.style.animationDuration=(0.3+Math.random()*0.5)+"s";
    d.style.animationDelay=Math.random()+"s";
    rain.appendChild(d);
  }
}

/* PETIR */
function startLightning(){
  lightningInterval=setInterval(()=>{
    if(Math.random()<0.35){
      flash.style.opacity=0.9;
      setTimeout(()=>flash.style.opacity=0,80);
      setTimeout(()=>{
        flash.style.opacity=0.6;
        setTimeout(()=>flash.style.opacity=0,60);
      },120);
    }
  },1500);
}

function stopLightning(){
  clearInterval(lightningInterval);
  flash.style.opacity=0;
}

function setCloudIntensity(percent){

const amount = Math.floor(percent*2); // 0‚Äì20 awan
createClouds(amount);

}

function createClouds(n){

const clouds = document.getElementById("clouds");
clouds.innerHTML = "";

for(let i=0;i<n;i++){

  const c = document.createElement("div");
  c.className = "cloud";

  const size = 120 + Math.random()*200;

  c.style.width = size+"px";
  c.style.height = size*0.6+"px";

  c.style.top = Math.random()*80 + "%";
  c.style.left = Math.random()*100 + "%";

  c.style.opacity = 0.3 + Math.random()*0.5;
c.style.zIndex = Math.floor(Math.random()*3);

  c.style.animation = `cloudFloat ${20+Math.random()*30}s ease-in-out infinite`;

  clouds.appendChild(c);
}
}

/* ================= WEATHER ================= */
function getWeather(lat,lon){

fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&lang=id&appid=${apiKey}`)
.then(r=>r.json())
.then(data=>{

setDynamicBackground(
data.weather[0].main.toLowerCase(),
data.sys.sunrise,
data.sys.sunset,
data.clouds.all
);


/* ===== BASIC ===== */

document.getElementById("city").innerText=data.name;
document.getElementById("temp").innerText=Math.round(data.main.temp)+"¬∞C";

const icon = getWeatherIcon(data.weather[0].main);

const uvData = calculateUV(
data.weather[0].main.toLowerCase(),
data.clouds.all,
(data.visibility ?? 10000) / 1000,
data.sys.sunrise,
data.sys.sunset,
data.coord.lat,
data.main.humidity
);

const feel = customFeelLike(
data.main.temp,
data.main.humidity,
data.wind.speed,
data.wind.gust,
data.weather[0].main.toLowerCase(),
data.sys.sunrise,
data.sys.sunset,
data.clouds.all,
uvData.value
);

document.getElementById("desc").innerText=
"RealFeel "+feel+"¬∞C | "+icon+" "+data.weather[0].description;

/* ===== EXTRA DATA ===== */

const wind=data.wind.speed;
const angin=Math.round(data.wind.speed*3.6);
const humidity = data.main.humidity;
/* ===== DEW POINT ===== */
const a = 17.27;
const b = 237.7;

const alpha = ((a * data.main.temp) / (b + data.main.temp)) + Math.log(humidity/100);
const dewPoint = (b * alpha) / (a - alpha);
let dewStatus = "Nyaman";

if(dewPoint >= 27) dewStatus = "Sangat Gerah ü•µ";
else if(dewPoint >= 24) dewStatus = "Gerah";
else if(dewPoint >= 20) dewStatus = "Lembap";
else if(dewPoint >= 16) dewStatus = "Sejuk";
else dewStatus = "Kering ‚ùÑÔ∏è";
const visibility = (data.visibility || 10000) / 1000;
const pressure=data.main.pressure;
const cloud = data.clouds.all;
const sunrise=formatTime(data.sys.sunrise);
const sunset=formatTime(data.sys.sunset);

const outdoorScore = calculateOutdoorScore(
feel,
data.weather[0].main.toLowerCase(),
uvData.value,
data.wind.speed,
visibility
);

const color =
outdoorScore >= 8 ? "#22c55e" :
outdoorScore >= 5 ? "#facc15" :
"#ef4444";

document.getElementById("outdoorScore").innerHTML = `
<b>Outdoor Activity Friendly:</b> ${outdoorScore}/10
<div class="scoreBar">
  <div class="scoreFill" style="width:${outdoorScore*10}%; background:${color}"></div>
</div>
`;

const cloudType = detectCloudType(
    data.clouds.all,
    uvData.value,
    feel,
    data.main.temp,
    data.weather[0].main.toLowerCase(),
    data.wind.gust,
    data.main.humidity,
    data.main.pressure,
    data.sys.sunrise,
    data.sys.sunset
);

document.getElementById("cloudType").innerText = cloudType;
applyCloudColor(cloudType);

let windStatus="Normal";
if(wind>5) windStatus="Kencang ‚ö†Ô∏è";
if(wind>10) windStatus="Sangat kencang ‚õî";

document.getElementById("extra").innerHTML=`
<b>Angin:</b> ${angin} Km/h (${windStatus})<br>
<b>Kelembapan:</b> ${humidity}%<br>
<b>Dew Point:</b> ${dewPoint.toFixed(1)}¬∞C (${dewStatus})<br>
<b>Tekanan:</b> ${pressure} hPa<br>
<b>Jarak Pandang:</b> ${visibility} km<br>
<b>Tutupan Awan:</b> ${cloud}%<br>
<b>UV Index:</b> ${uvData.value} (${uvData.category})<br>
<b>Sunrise:</b> ${sunrise}<br>
<b>Sunset:</b> ${sunset}
`;

document.getElementById("recommendation").innerHTML =
recommendation(
    feel,
    data.weather[0].main.toLowerCase(),
    data.wind.speed
);

/* ===== RIDING WARNING ===== */

let warning="Kondisi aman untuk riding motor custom.";

if(data.weather[0].main.toLowerCase().includes("rain")){
warning="‚ö†Ô∏è Jalanan licin! Hindari rebah ekstrem & akselerasi mendadak.";
}

if(visibility<5){
warning+=" ‚ö†Ô∏è Jarak pandang rendah! Gunakan lampu & jaga jarak.";
}

if(wind>10){
warning+=" ‚ö†Ô∏è Waspadai crosswind saat riding.";
}

if(data.weather[0].main.toLowerCase().includes("thunderstorm")){
warning="‚õî Badai petir! Tidak disarankan riding.";
}

document.getElementById("warning").innerHTML="<b>Safety Riding:</b><br>"+warning;

});
}

function getWindEffect(temp, humidity, wind, gust){

let v = (wind + gust)/2

if(v < 1) return 0; // hampir tidak terasa

let effect = 0;

/* ========================= */
/* ===== COOLING MODE ====== */
/* ========================= */

// kalau udara lebih dingin dari kulit
if(temp < 39){

   // kelembapan rendah ‚Üí cooling maksimal
   if(humidity < 60){
      effect = v * 0.4;
   }

   // kelembapan sedang
   else if(humidity < 80){
      effect = v * 0.25;
   }

   // kelembapan tinggi ‚Üí cooling lemah
   else{
      effect = v * 0.1;
   }
}

/* ========================= */
/* ===== HOT WIND MODE ===== */
/* ========================= */

// kalau udara lebih panas dari kulit
else{

   if(humidity > 70){
      effect = - (v * 0.2); // tambah panas
   }
   else{
      effect = - (v * 0.05);
   }
}

return effect;
}

function customFeelLike(temp, humidity, wind, gust, weatherMain, sunrise, sunset, cloudPercent, uv){

const now = Date.now()/1000;
const isDay = (now > sunrise && now < sunset);

// Ambil waktu sekarang dalam DETIK (Unix)

// Hitung selisih jam secara langsung (Detik ke Jam)
let hoursAfterSunrise = (now - sunrise) / 3600;
let hoursAfterSunset = (now - sunset) / 3600;

// Handle jika sunset kemarin (lewat tengah malam)
if (now < sunset && hoursAfterSunset < -12) {
    hoursAfterSunset += 24;
}

// nanti kita kontrol di logic

/* ========================= */
/* ===== SAFETY FIX ======== */
/* ========================= */

humidity = Math.max(1, humidity); // cegah log(0)
cloudPercent = cloudPercent ?? 0;

/* ========================= */
/* ===== DEW POINT ========= */
/* ========================= */

const a = 17.27;
const b = 237.7;

const alpha = ((a * temp) / (b + temp)) + Math.log(humidity/100);
const dew = (b * alpha) / (a - alpha);


/* ========================= */
/* ===== SOLAR ANGLE ======= */
/* ========================= */

let hour = new Date().getHours();
let feel = temp;

// ======================
// MODE SIANG / PAGI
// ======================

/* ============================================= */
/* ===== UNIVERSAL PRE-MORNING COOL ENGINE ===== */
/* ============================================= */

let morningCoolMemory = 0;

if (hoursAfterSunrise >= -3 && hoursAfterSunrise <= 1) {
    
    // 1. DINAMIKA KEKUATAN (Strength berdasarkan Langit)
    // Di iklim kering/cerah, radiasi panas hilang lebih cepat (lebih dingin).
    // Di iklim mendung/lembab, penurunan suhu lebih tertahan.
    let skyFactor = 1 + ( (100 - cloudPercent) / 100 ); // Range 1.0 (mendung) s/d 2.0 (cerah)
    
    // Base strength yang menyesuaikan suhu lokal
    let baseStrength = Math.max(0, (28 - temp) * 0.5); 
    let finalStrength = baseStrength * skyFactor;

    // Batasi agar tidak ekstrem (Max 5 derajat pengurang)
    finalStrength = Math.min(5, finalStrength);

    // 2. LOGIKA 3 TAHAP (Progressif)
    if (hoursAfterSunrise < -1.5) {
        // Tahap Awal: Dini hari
        let progress = (hoursAfterSunrise + 3) / 1.5; 
        morningCoolMemory = -(finalStrength * 0.4 * progress);
    }
    else if (hoursAfterSunrise >= -1.5 && hoursAfterSunrise <= 0.5) {
        // Tahap Puncak: Fajar (Titik terdingin)
        morningCoolMemory = -finalStrength;
    }
    else {
        // Tahap Akhir: Pasca Sunrise (Mencair)
        let decay = 1 - (hoursAfterSunrise - 0.5) / 0.5;
        morningCoolMemory = -(finalStrength * decay);
    }
}

feel += morningCoolMemory;

if(isDay){

   // Jam sebelum 8 pagi belum ada solar heating maksimal
let solarFactor = 0;

if (hour >= 7 && hour <= 17) {
    // 1. Time Weight (Kurva Parabola)
    // Puncaknya di jam 12 siang (nilai 1.0), jam 7 pagi dan 5 sore mendekati 0.
    let timeProgress = (hour - 7) / (17 - 7); // 0 (jam 7) sampai 1 (jam 17)
    let timeWeight = Math.sin(timeProgress * Math.PI); // Kurva melengkung mulus
    
    // 2. UV Intensity Nonlinear
    // Menggunakan Math.sqrt agar UV rendah sudah mulai terasa, 
    // tapi UV ekstrem (11+) tidak membuat RealFeel meledak tak terkendali.
    let uvWeight = Math.sqrt(uv / 11); 

    // 3. Skala Maksimal (Misal +4¬∞C saat tengah hari bolong)
    solarFactor = timeWeight * uvWeight * 4.0;
}

  // beberapa kondisi cuaca ‚Üí dingin
  if(weatherMain.includes("drizzle")) feel -= 1.5;
  if(weatherMain.includes("rain")) feel -= 3;
  if(weatherMain.includes("thunderstorm")) feel -= 4;
if(weatherMain.includes("mist") || weatherMain.includes("fog")) feel -= 0.1;

    let humidityFactor = 0;
    let tempDelta = temp - 25; 

    // Buat bobot kelembapan nonlinear (Pangkat 2)
    // 0.5 (50%) jadi 0.25 | 0.9 (90%) jadi 0.81 | 1.0 (100%) tetap 1.0
    let normalizedHumid = humidity / 100;
    let nonLinearHumid = Math.pow(normalizedHumid, 2) * 100;

    if (temp > 25) {
        // Logika Pemanasan (Gerah)
        let multiplier = 0.03;
        if (temp > 35) {
            multiplier = 0.03 + (Math.min(temp, 45) - 35) * 0.003; 
        }
        if (temp > 45) multiplier = 0.07;
        
        // Menggunakan nonLinearHumid agar gerah terasa "nendang" di atas 90%
        humidityFactor = (nonLinearHumid * multiplier) * (tempDelta * 0.2); 
    } 
    else {
        // Logika Pendinginan (Chill)
        // Semakin lembap, semakin dinginnya "nusuk" secara nonlinear
        humidityFactor = (nonLinearHumid * 0.005) * tempDelta; 
    }

// 1. Normalisasi 0-100 ke 0-1
let cloudFraction = cloudPercent / 100;

// 2. CloudCooling Nonlinear (Akar Kuadrat)
// Sedikit awan langsung memotong terik matahari secara signifikan
let cloudCoolingFactor = Math.sqrt(cloudFraction);

// 3. Skala Maksimal 3¬∞C (Sesuai permintaanmu)
let cloudCooling = cloudCoolingFactor * 3.0;

// 4. Update RealFeel
feel -= cloudCooling;

   let windEffect = getWindEffect(temp, humidity, wind, gust);

   feel += solarFactor + humidityFactor - cloudCooling - windEffect;

}

/* ========================= */
/* ===== NIGHT (CHILL) ===== */
/* ========================= */

else{

  const v = ((wind+gust)/2) * 3.6;

let windChillEffect = 0;

if (temp <= 10 && v >= 5) {
  const wc =
    13.12 +
    0.6215 * temp -
    11.37 * Math.pow(v, 0.16) +
    0.3965 * temp * Math.pow(v, 0.16);

  windChillEffect = wc - temp;
feel += windChillEffect
}else{
let intensity = 0.05 + (Math.max(0, 25 - temp) * 0.015); 
let windEffectNight = (Math.sqrt(v) * (intensity * 2.5));
feel -= windEffectNight

console.log(`5. Wind Effect: ${windEffectNight.toFixed(2)}¬∞C`);
}

let nightFactor = 0;

if (hoursAfterSunset <= 1) {
  nightFactor = 0; // Netral
}
else if (hoursAfterSunset <= 3) {
  nightFactor = (hoursAfterSunset - 1) / 2; // 0 ‚Üí 1 secara gradual
}
else {
  nightFactor = 1; // Stabil penuh
}

let surfaceMemory = 0;

if (hoursAfterSunset <= 3) {

  // decay 1 ‚Üí 0 dalam 3 jam
  let decay = 1 - (hoursAfterSunset / 3);

  // Estimasi kekuatan panas dari suhu saat ini
  // 25¬∞C jadi titik netral
  let heatStrength = (temp - 25) * 0.15;

  // Clamp biar nggak liar
  heatStrength = Math.max(0, Math.min(1.8, heatStrength));

  surfaceMemory = heatStrength * decay;
}

feel += surfaceMemory;


// 1. Normalisasi 0-100 ke 0-1
let cloudFraction = cloudPercent / 100;

// 2. CloudWeight (Nonlinear)
// Kita pakai pangkat 1.5 biar kurvanya gak terlalu ekstrem tapi tetap berasa bedanya
let cloudWeight = Math.pow(cloudFraction, 1.5); 

// 3. Menghitung Cloud Effect
// Kita geser titik tengahnya. Jika cloudWeight > 0.5 (mendung), hasilnya positif.
// Jika cloudWeight < 0.5 (cerah), hasilnya negatif.
let cloudEffect = (cloudWeight - 0.5) * 2 * 2.0 * nightFactor;

// 4. Clamp (Biar gak lewat dari rentang -2 sampai +2)
cloudEffect = Math.max(-2, Math.min(2, cloudEffect));

feel += cloudEffect;

let humidityEffect = 0;

if (humidity > 70) {
    let tempDelta = temp - 25;

    // Skala kelembapan (0 sampai 1)
    let baseStrength = (humidity - 70) / 30; 
    
    // Gunakan Pangkat (misal pangkat 2 atau 1.5)
    // Ini membuat 80% terasa ringan, tapi 98% terasa berat banget
    let humidityStrength = Math.pow(baseStrength, 2); 

    humidityEffect = tempDelta * humidityStrength;

    // Batasi maksimum ¬±4¬∞C (kita naikkan sedikit batasnya karena efek nonlinear)
    humidityEffect = Math.max(-4, Math.min(4, humidityEffect));
}

if (humidityEffect > 0){
feel += humidityEffect * 0.8;
}else{
feel += humidityEffect;
}

 // beberapa kondisi cuaca ‚Üí dingin
  if(weatherMain.includes("drizzle")) feel -= 0.8;
  if(weatherMain.includes("rain")) feel -= 1.5;
  if(weatherMain.includes("thunderstorm")) feel -= 2;
  if(weatherMain.includes("mist") || weatherMain.includes("fog")) feel -= 1.2;

/* ========================= */
    /* ===== DEBUG CONSOLE ====== */
    /* ========================= */
    console.log(`1. Morning Memory: ${morningCoolMemory.toFixed(2)}¬∞C`);
    console.log(`3. Humidity Effect: ${humidityEffect.toFixed(2)}¬∞C`);
    console.log(`4. Cloud Effect: ${cloudEffect.toFixed(2)}¬∞C`);

}

/* ========================= */
    /* ===== DEBUG CONSOLE ====== */
    /* ========================= */
    console.log(`--- WEATHER DEBUG [${isDay ? 'SIANG' : 'MALAM'}] ---`);
    console.log(`Suhu Dasar: ${temp}¬∞C`);

    console.log(`TOTAL REALFEEL: ${Math.round(feel)}¬∞C`);
    console.log(`-----------------------------------`);

/* ========================= */

return Math.round(feel);
}


function recommendation(feelLike, weather, wind){

let outfit="";
let activity="";
let warning="";

/* ============================= */
/* ====== SUHU BERDASARKAN FEEL LIKE ====== */
/* ============================= */

if(feelLike >= 38){
outfit="Tanktop breathable / kaos boxy dry-fit + flanel tipis (dibuka) + cargo short + high socks + sneakers mesh ringan + sunglasses + sling bag + sunscreen";
activity="Built Up Custom indoor, Gym ringan pagi/sore. Hindari riding/aktivitas outdoor saat siang terik.";
warning = "‚ö†Ô∏è cuaca panas ekstrem, gunakan alat pendingin ruangan untuk membuat zona suhu nyaman anda tetap stabil.";    
}

else if(feelLike >= 35){
outfit="Kaos oversized premium dry-fit + cargo short + sneakers breathable + topi + jam tangan + kacamata hitam";
activity="Riding Motor Custom jarak dekat sore hari, Hangout, atau Built Up Custom.";
}

else if(feelLike >= 32){
outfit="Workshirt lengan pendek + chino slim / cargo tipis + sepatu casual kulit / sneakers klasik + jam tangan";
activity="Riding Motor Custom, Skateboarding, atau Hangout sore.";
}

else if(feelLike >= 29){
outfit="Workshirt digulung + jeans straight fit ringan + sepatu kulit ringan / sneakers klasik + sling bag minimalis";
activity="Riding Motor Custom, Memanah outdoor, atau Gym.";
}

else if(feelLike >= 25){
outfit="Coach jacket tipis / rompi / jas + kemeja flanel / tebal + jeans + boots + jam tangan";
activity="Camping, Climbing, Riding Motor Custom, Riding jarak menengah.";
}

else if(feelLike >= 20){
outfit="Jaket Kulit / denim + kaos tebal + celana chinos + boots + sarung tangan";
activity="Taktikal training ringan, Memanah, atau Built Up Motor Custom.";
}

else if(feelLike >= 15){
outfit="Layering: jacket tebal / mantel + celana chinos tebal + boots + sarung tangan";
activity="Climbing dingin, perawatan motor detail, latihan taktikal.";
}

else{
outfit="Mantel tebal full thermal + celana thermal + boots + beanie + neck warmer";
activity="Fokus indoor: Built Up Custom detail, perencanaan proyek, latihan taktik teori, gym, bobok.";
}


/* ============================= */
/* ===== MODIFIER CUACA ======== */
/* ============================= */

if(weather.includes("rain")){
outfit += " + Jaket waterproof / raincoat set + tas anti air";
activity = "Built Up Custom indoor, Gym, atau latihan taktik indoor.";
warning = "‚ö†Ô∏è Jalanan licin! Hindari akselerasi mendadak dan rebah ekstrem saat riding motor custom.";
}

if(weather.includes("drizzle")){
warning += " ‚ö†Ô∏è Aspal lembap. Jaga jarak pengereman dan hindari ban botak.";
}

if(weather.includes("thunderstorm")){
activity = "Tunda semua aktivitas outdoor. Fokus indoor.";
warning = "‚õî Badai petir! Sangat tidak disarankan mengendarai motor custom.";
}

if(weather.includes("mist") || weather.includes("fog")){
activity = "Batasi kegiatan outdoor karena jarak pandang berkurang!";
warning = "‚ö†Ô∏è Cuaca berkabut! Disarankan untuk mengendarai motor custom secara berhati-hati karena jarak pandang berkurang!";
}

if(weather.includes("cloud") && feelLike >= 28){
activity += " Cuaca mendukung aktivitas outdoor tanpa panas berlebih.";
}

if(wind > 10){
warning += " üå¨Ô∏è Angin cukup kencang, waspadai crosswind saat riding.";
}


/* ============================= */
/* ===== OUTPUT FINAL ========== */
/* ============================= */

return `
<b>Outfit Rekomendasi:</b><br>${outfit}
<br><br>
<b>Aktivitas Maskulinitas:</b><br>${activity}
<br><br>
<b>Safety Notice:</b><br>${warning || "Kondisi aman untuk aktivitas."}
`;
}

function getCloudReduction(cloudPercent, weatherMain, visibility, humidity){

let reduction = 0;

/* ============================= */
/* ===== NONLINEAR CURVE ======= */
/* ============================= */

reduction = 0.05 + (cloudPercent / 100) * 0.6;
if(cloudPercent > 90){
  reduction += 0.03;
}

/* ============================= */
/* ===== WEATHER OVERRIDE ====== */
/* ============================= */

weatherMain = weatherMain.toLowerCase();

if(weatherMain.includes("rain")){
  reduction += 0.1;
}

if(weatherMain.includes("thunderstorm")){
  reduction = 0.95;
}

if(weatherMain.includes("mist") || weatherMain.includes("fog")){
  reduction += 0.15;
}

/* ============================= */
/* ===== ATMOSPHERIC FACTOR ==== */
/* ============================= */

// jarak pandang rendah ‚Üí partikel tinggi
if(visibility < 5){
  reduction += 0.1;
}

// humidity sangat tinggi ‚Üí difusi cahaya
if(humidity > 90){
  reduction += 0.05;
}

/* clamp biar gak over */
reduction = Math.min(reduction, 0.97);

return reduction;
}

function calculateUV(weatherMain, cloud, visibility, sunrise, sunset, lat, humidity){

const nowDate = new Date();
const now = nowDate.getTime()/1000;

if(now < sunrise || now > sunset){
  return { value: 0, category: "Night Mode üåô" };
}


/* ========================= */
/* ===== DAY OF YEAR ======= */
/* ========================= */

const start = new Date(nowDate.getFullYear(),0,0);
const diff = nowDate - start;
const day = Math.floor(diff/86400000);


/* ========================= */
/* ===== DECLINATION ======= */
/* ========================= */

const decl =
23.44 * Math.sin((2*Math.PI/365)*(day-81));


/* ========================= */
/* ===== HOUR ANGLE ======== */
/* ========================= */

const hour = nowDate.getHours() + nowDate.getMinutes()/60;
const hourAngle = (hour - 12) * 15; // deg


/* ========================= */
/* ===== SOLAR ELEVATION === */
/* ========================= */

const latRad = lat*Math.PI/180;
const decRad = decl*Math.PI/180;
const hRad = hourAngle*Math.PI/180;

const sinElev =
Math.sin(latRad)*Math.sin(decRad) +
Math.cos(latRad)*Math.cos(decRad)*Math.cos(hRad);

const sunFactor = Math.max(0, sinElev);


/* ========================= */
/* ===== BASE UV (physics) == */
/* ========================= */

let uv = 12 * sunFactor;


/* ========================= */
/* ===== CLOUD MOD ========= */
/* ========================= */

/* ========================= */
/* ===== NONLINEAR REDUCTION */
/* ========================= */

let reduction = getCloudReduction(
  cloud,
  weatherMain,
  visibility,
  humidity ?? 80
);

uv *= (1 - reduction);


/* ========================= */
/* ===== WEATHER MOD ======= */
/* ========================= */

weatherMain = weatherMain.toLowerCase();



/* ========================= */
/* ===== VISIBILITY MOD ==== */
/* ========================= */




/* ========================= */
/* ===== FINAL ======= */
/* ========================= */

uv = Math.max(0, Math.min(12, Math.round(uv)));


/* ========================= */
/* ===== CATEGORY ========= */
/* ========================= */

let category="";
if(uv<=2) category="Low";
else if(uv<=5) category="Moderate";
else if(uv<=7) category="High";
else if(uv<=10) category="Very High";
else category="Extreme ‚òÄÔ∏è";

return { value: uv, category };
}

function detectCloudType(
  cloudPercent,
  uvValue,
  realFeel,
  temp,
  weatherMain,
  windGust,
  humidity,
  pressure,
  sunrise,
  sunset
){

  const now = Date.now()/1000;
  const isDay = (now > sunrise && now < sunset);

  const solarPeak = (sunrise + sunset) / 2;
  const midDayWindow = 2 * 3600; // 2 jam
  const isMidDay = Math.abs(now - solarPeak) < midDayWindow;

  /* ========================= */
  /* ===== CUMULONIMBUS ====== */
  /* ========================= */

  // CB Aktif (storm logic dari API)
  if(weatherMain.includes("thunderstorm")){
    return "Cumulonimbus Aktif ‚õàÔ∏è";
  }

  // CB Hujan tanpa petir
  if(weatherMain.includes("rain") &&
     cloudPercent > 80 &&
     windGust > 5){
    return "Cumulonimbus Pasif üå©Ô∏è";
  }

  // CB Lewat (anvil lewat tanpa hujan)
  let cbScore = 0;

  if(cloudPercent > 84) cbScore += 1;
  if(cloudPercent > 94) cbScore += 1;

  if(humidity > 85) cbScore += 1;
  if(humidity > 90) cbScore += 1;

  if(windGust > 3) cbScore += 1;
  if(windGust > 6) cbScore += 1;

  if(pressure < 1008) cbScore += 1;
  if(pressure < 1005) cbScore += 1;

  if(isDay){
    if(isMidDay && uvValue <= 3) cbScore += 1;
    if(isMidDay && uvValue <= 2) cbScore += 1;
  }

  if(cbScore >= 6){
    return "Cumulonimbus Lewat üå™Ô∏è";
  }

  /* ========================= */
  /* ===== STRATIFORM ======== */
  /* ========================= */

  if(
     cloudPercent > 85 &&
     windGust < 5 &&
     humidity > 70
  ){
    return "Stratiform Overcast ‚òÅÔ∏è";
  }

  /* ========================= */
  /* ===== BROKEN CLOUDS ===== */
  /* ========================= */

  if(cloudPercent >= 60){
    return "Stratocumulus üå•Ô∏è";
  }

  if(cloudPercent >= 40){
    return "Scattered Cumulus üå•Ô∏è";
  }

  /* ========================= */
  /* ===== CLEAR SKY ========= */
  /* ========================= */

  return isDay ? "Clear Sky ‚òÄÔ∏è" : "Clear Night üåô";
}

function applyCloudColor(type){

  const el = document.getElementById("cloudType");

  el.style.fontWeight = "600";

  switch(type){

    case "Cumulonimbus ‚õàÔ∏è":
      el.style.color = "#ff4d4d"; // merah badai
      break;

    case "Stratiform Overcast ‚òÅÔ∏è":
      el.style.color = "#bfbfbf"; // abu mendung
      break;

    case "Stratocumulus üå•Ô∏è":
      el.style.color = "#ffffff"; // putih netral
      break;

    case "Scattered Cumulus üå•Ô∏è":
      el.style.color = "#ffffff"; // putih netral
      break;

    case "Clear Sky ‚òÄÔ∏è":
      el.style.color = "#ffd633"; // kuning cerah
      break;

    default:
      el.style.color = "#ffffff";

case "Cumulonimbus Aktif ‚õàÔ∏è":
case "Cumulonimbus Pasif üå©Ô∏è":
case "Cumulonimbus Lewat üå™Ô∏è":
  el.style.color = "#ff4d4d";
  break;

case "Clear Night üåô":
  el.style.color = "#aaccff";
  break;

  }

}

function calculateOutdoorScore(feelLike, weatherMain, uv, wind, visibility){

let score = 10;

/* ================= */
/* ===== UV ======== */
/* ================= */

if(uv >= 11) score -= 7;
else if(uv >= 8) score -= 5;
else if(uv >= 6) score -= 3;
else if(uv >= 3) score -= 1;


/* ================= */
/* ===== WEATHER ==== */
/* ================= */

if(weatherMain.includes("thunderstorm")) score -= 9;
else if(weatherMain.includes("rain")) score -= 7;
else if(weatherMain.includes("drizzle")) score -= 5;
else if(weatherMain.includes("mist") || weatherMain.includes("fog")) score -= 2;


/* ================= */
/* ===== WIND ======= */
/* ================= */

if(wind > 10) score -= 2;
else if(wind > 5) score -= 1;


/* ================= */
/* ===== VISIBILITY = */
/* ================= */

if(visibility < 3) score -= 3;
else if(visibility < 6) score -= 1;


/* ================= */
/* ===== TEMP ======= */
/* ================= */

if(feelLike > 35) score -= 3;
else if(feelLike > 32) score -= 2;
else if(feelLike < 18) score -= 2;
else if(feelLike < 14) score -= 3;


/* clamp */
score = Math.max(1, Math.min(10, score));

return score;
}


function formatTime(unix){
const d = new Date(unix * 1000);
return d.toLocaleTimeString("id-ID", {
  hour: "2-digit",
  minute: "2-digit"
});
}

function getWeatherIcon(main){

main = main.toLowerCase();

if(main.includes("clear")) return "‚òÄÔ∏è";
if(main.includes("cloud")) return "üå§Ô∏è";
if(main.includes("rain")) return "üåßÔ∏è";
if(main.includes("drizzle")) return "üå¶Ô∏è";
if(main.includes("thunderstorm")) return "‚õàÔ∏è";
if(main.includes("mist") || main.includes("fog")) return "üå´Ô∏è";

return "üå°Ô∏è";
}

</script>

</body>
</html>
